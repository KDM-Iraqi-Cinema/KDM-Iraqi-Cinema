<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¥Ø¯Ø§Ø±Ø© Ù…ÙØ§ØªÙŠØ­ KDM - Ø§Ù„Ø³ÙŠÙ†Ù…Ø§ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠØ©</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

  body {
    background: linear-gradient(135deg, #2a014c, #3b0f71);
    color: #e0d9f0;
    font-family: 'Cairo', sans-serif;
    margin: 0;
    padding: 25px 15px;
  }

  h1 {
    text-align: center;
    color: #d2b9ff;
    font-weight: 900;
    font-size: 2.8rem;
    margin-bottom: 40px;
    user-select: none;
    text-shadow: 0 0 8px #a077ffaa;
  }

  form {
    max-width: 500px;
    margin: 0 auto 40px;
    background-color: #3a2161dd;
    border-radius: 12px;
    padding: 25px 30px;
    box-shadow: 0 0 15px #6b4bff77;
  }

  label {
    display: block;
    margin-bottom: 10px;
    font-weight: 700;
    color: #cbbcff;
    font-size: 1.1rem;
  }

  input[type="text"],
  input[type="datetime-local"] {
    width: 100%;
    padding: 12px 14px;
    margin-bottom: 18px;
    border: none;
    border-radius: 8px;
    background-color: #5c4299cc;
    color: #f3ecff;
    font-size: 1rem;
    box-sizing: border-box;
    transition: background-color 0.3s, box-shadow 0.3s;
  }

  input[type="text"]::placeholder,
  input[type="datetime-local"]::placeholder {
    color: #bba6ffcc;
  }

  input[type="text"]:focus,
  input[type="datetime-local"]:focus {
    outline: none;
    background-color: #6c55b3ee;
    box-shadow: 0 0 10px #b8a3ffcc;
  }

  .desc-text {
    color: #b9a9ffcc;
    font-size: 0.95rem;
    margin-top: -12px;
    margin-bottom: 14px;
    user-select: none;
  }

  button {
    width: 100%;
    background: linear-gradient(90deg, #7e57c2, #512da8);
    color: #f4f1ff;
    font-weight: 700;
    border: none;
    border-radius: 10px;
    padding: 14px 0;
    font-size: 1.15rem;
    cursor: pointer;
    box-shadow: 0 4px 12px #673ab733;
    transition: background 0.4s ease;
    user-select: none;
  }

  button:hover {
    background: linear-gradient(90deg, #9f7de8, #6844c6);
  }

  #searchInput {
    max-width: 500px;
    margin: 0 auto 30px;
    display: block;
    padding: 12px 14px;
    border-radius: 8px;
    border: none;
    background-color: #5c4299cc;
    color: #f3ecff;
    font-size: 1rem;
    box-sizing: border-box;
    user-select: text;
  }

  table.kdm-list {
    width: 95%;
    max-width: 900px;
    margin: 0 auto;
    border-collapse: separate;
    border-spacing: 0 15px;
    table-layout: fixed;
  }

  table.kdm-list thead th {
    background-color: #5e3da3;
    color: #ddd7ff;
    font-weight: 800;
    padding: 15px 20px;
    font-size: 1.1rem;
    border-radius: 10px 10px 0 0;
    user-select: none;
  }

  /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
  table.kdm-list thead th:nth-child(1),
  table.kdm-list tbody td:nth-child(1) {
    padding-left: 25px;
    padding-right: 25px;
  }
  table.kdm-list thead th:nth-child(2),
  table.kdm-list tbody td:nth-child(2),
  table.kdm-list thead th:nth-child(3),
  table.kdm-list tbody td:nth-child(3) {
    padding-left: 15px;
    padding-right: 15px;
  }
  table.kdm-list thead th:nth-child(4),
  table.kdm-list tbody td:nth-child(4) {
    padding-left: 25px;
    padding-right: 25px;
  }

  table.kdm-list tbody tr.kdm-row {
    background: linear-gradient(90deg, #3c2671, #4a3389);
    box-shadow: 0 5px 15px #6a4fcfcc;
    color: #e0d9f0;
    font-weight: 600;
    transition: background-color 0.3s ease;
    border-radius: 12px;
    word-wrap: break-word;
  }

  table.kdm-list tbody tr.kdm-row td {
    padding: 15px 18px;
    text-align: center;
    vertical-align: middle;
    user-select: text;
  }

  /* Ù„ÙˆÙ† Ø£Ø­Ù…Ø± ÙƒØ§Ù…Ù„ Ù‚Ø¨Ù„ 5 Ø£ÙŠØ§Ù… Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ */
  table.kdm-list tbody tr.kdm-row.ending-soon {
    background: #a43535 !important;
    box-shadow: 0 5px 15px #b94444cc !important;
    color: #fff !important;
  }

.action-btn {
  margin: 0 6px;
  padding: 10px 16px;
  font-weight: 700;
  border-radius: 9px;
  border: none;
  cursor: pointer;
  user-select: none;
  font-size: 1rem;
  line-height: 1.2;
  vertical-align: middle;
  font-family: 'Cairo', sans-serif;
  display: inline-block;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

  .edit-btn {
    background: linear-gradient(90deg, #9173d7, #6e49b7);
    color: #f1eaff;
    box-shadow: 0 3px 8px #7d64d9cc;
  }
  .edit-btn:hover {
    background: linear-gradient(90deg, #b19af5, #8a6de3);
    box-shadow: 0 5px 15px #9f89ecbb;
  }

  .delete-btn {
    background: linear-gradient(90deg, #d1436f, #9e2145);
    color: #ffe7e7;
    box-shadow: 0 3px 8px #c6547fbb;
  }
  .delete-btn:hover {
    background: linear-gradient(90deg, #e5749c, #b73769);
    box-shadow: 0 5px 15px #e0709dbc;
  }

  .empty-msg {
    text-align: center;
    font-size: 1rem;
    color: #b9a9ffcc;
    padding: 30px 0;
    user-select: none;
  }

@media (max-width: 600px) {
  table.kdm-list tbody tr.kdm-row td {
    padding: 8px 10px;  /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø£ÙÙ‚ÙŠØ© ÙˆØ§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ© */
    white-space: normal; /* Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ù„Ù Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø© */
  }

  /* ØªÙ‚Ù„ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù…ÙƒÙ† */
  table.kdm-list thead th, 
  table.kdm-list tbody tr.kdm-row td {
    font-size: 0.85rem;
    padding: 8px 10px;
  }
}
</style>
</head>
<body>

<h1>Ø¥Ø¯Ø§Ø±Ø© Ù…ÙØ§ØªÙŠØ­ KDM - Ø§Ù„Ø³ÙŠÙ†Ù…Ø§ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠØ©</h1>

<form id="kdmForm">
  <label for="movieName">Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…:</label>
  <input type="text" id="movieName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…" required />

  <div class="desc-text">Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø¨Ø¯Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙØªØ§Ø­ (KDM):</div>
  <input type="datetime-local" id="startTime" required placeholder="ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©" />

  <div class="desc-text">Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…ÙØªØ§Ø­ (KDM):</div>
  <input type="datetime-local" id="endTime" required placeholder="ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡" />

  <button type="submit">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØªØ§Ø­</button>
</form>



<button id="logoutBtn" title="ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬" style="
    position: fixed;
    top: 15px;
    right: 15px;
    background-color: #c0392b;
    border: none;
    color: white;
    width: 40px;
    height: 40px;
    font-size: 24px;
    font-weight: bold;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
">
    Ã—
</button>




  <a href="account-manager.html" style="position: fixed; top: 10px; left: 10px; background: #007bff; color: white; padding: 10px; border-radius: 6px;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</a>




  

<input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…..." aria-label="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…" />

<table class="kdm-list" id="kdmTable" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØ§ØªÙŠØ­ KDM">
  <thead>
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„ÙÙŠÙ„Ù…</th>
      <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</th>
      <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
    </tr>
  </thead>
  <tbody id="kdmBody">
    <!-- Ù…ÙØ§ØªÙŠØ­ KDM Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
  </tbody>
</table>

<script>
  const apiUrl = 'https://kdm-iraqi-cinema.onrender.com/kdms';

  const kdmForm = document.getElementById('kdmForm');
  const kdmBody = document.getElementById('kdmBody');
  const searchInput = document.getElementById('searchInput');

  let isEditing = false;
  let editingId = null;
  let kdmsData = [];

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± ÙˆØ¹Ø±Ø¶Ù‡Ø§
  async function loadKDMs() {
    try {
      const res = await fetch(apiUrl);
      if (!res.ok) throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
      kdmsData = await res.json();
      displayKDMs(kdmsData);
    } catch (error) {
      alert(error.message);
    }
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ø¨Ø­Ø«
  function displayKDMs(kdms) {
    kdmBody.innerHTML = '';

    if (kdms.length === 0) {
      kdmBody.innerHTML = `<tr><td colspan="4" class="empty-msg">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙØ§ØªÙŠØ­ KDM Ù…Ø³Ø¬Ù„Ø©</td></tr>`;
      return;
    }

    const now = new Date();
    kdms.forEach(({ _id, movieName, startTime, endTime }) => {
      const start = new Date(startTime);
      const end = new Date(endTime);
      const diffDays = Math.ceil((end - now) / (1000 * 60 * 60 * 24));
      const isEndingSoon = diffDays <= 5 && diffDays >= 0;

      const row = document.createElement('tr');
      row.className = 'kdm-row' + (isEndingSoon ? ' ending-soon' : '');

      row.innerHTML = `
        <td>${escapeHTML(movieName)}</td>
        <td>${start.toLocaleString('en-US', { hour12: false })}</td>
        <td>${end.toLocaleString('en-US', { hour12: false })}</td>
        <td>
          <button class="action-btn edit-btn" onclick="editKDM('${_id}', '${escapeJS(movieName)}', '${startTime}', '${endTime}')">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="action-btn delete-btn" onclick="deleteKDM('${_id}')">Ø­Ø°Ù</button>
        </td>
      `;
      kdmBody.appendChild(row);
    });
  }

  // Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø£Ø­Ø±Ù HTML Ø§Ù„Ø®Ø§ØµØ©
  function escapeHTML(text) {
    return text.replace(/[&<>"']/g, function(m) {
      return ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m];
    });
  }

  // Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† Ø£Ø­Ø±Ù Ø®Ø§ØµØ© Ø¹Ù†Ø¯ ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù†Øµ ÙÙŠ Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª
  function escapeJS(text) {
    return text.replace(/'/g, "\\'");
  }

  // Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯
  kdmForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const movieName = document.getElementById('movieName').value.trim();
    const startTime = document.getElementById('startTime').value;
    const endTime = document.getElementById('endTime').value;

    if (!movieName || !startTime || !endTime) {
      alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.');
      return;
    }

    try {
      if (isEditing && editingId) {
        const res = await fetch(`${apiUrl}/${editingId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ movieName, startTime, endTime })
        });

        if (!res.ok) throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙØªØ§Ø­.');

        resetForm();
        await loadKDMs();
      } else {
        const res = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ movieName, startTime, endTime })
        });

        if (!res.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØªØ§Ø­.');

        kdmForm.reset();
        await loadKDMs();
      }
    } catch (error) {
      alert(error.message);
    }
  });

  // Ø­Ø°Ù Ù…ÙØªØ§Ø­
  async function deleteKDM(id) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ØŸ')) return;
    try {
      const res = await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
      if (!res.ok) throw new Error('ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ÙØªØ§Ø­.');
      await loadKDMs();
    } catch (error) {
      alert(error.message);
    }
  }

  // ØªØ¹Ø¯ÙŠÙ„ Ù…ÙØªØ§Ø­
  function editKDM(id, movieName, startTime, endTime) {
    document.getElementById('movieName').value = movieName;
    document.getElementById('startTime').value = startTime;
    document.getElementById('endTime').value = endTime;

    kdmForm.querySelector('button').textContent = 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„';
    isEditing = true;
    editingId = id;
  }

  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
  function resetForm() {
    kdmForm.reset();
    isEditing = false;
    editingId = null;
    kdmForm.querySelector('button').textContent = 'â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙØªØ§Ø­';
  }

  // ØªØµÙÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø«
  searchInput.addEventListener('input', () => {
    const filter = searchInput.value.trim().toLowerCase();
    if (!filter) {
      displayKDMs(kdmsData);
      return;
    }
    const filtered = kdmsData.filter(kdm => kdm.movieName.toLowerCase().includes(filter));
    displayKDMs(filtered);
  });

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  loadKDMs();

  // Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø²Ø± ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù…Ù† HTML inline
  window.editKDM = editKDM;
  window.deleteKDM = deleteKDM;
</script>





<script>
    document.getElementById('logoutBtn').addEventListener('click', function() {
        localStorage.removeItem('loggedIn');  // Ù…Ø³Ø­ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        window.location.href = 'index.html';  // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (ØºÙŠØ± Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø¥Ø°Ø§ Ù…Ø®ØªÙ„Ù)
    });

    // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    if (localStorage.getItem('loggedIn') !== 'true') {
        window.location.href = 'index.html'; // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø§Ù„Ø¯Ø®ÙˆÙ„
    }
</script>



  

</body>
</html>
